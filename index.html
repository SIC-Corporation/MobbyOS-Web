<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobbyOS | SIC Corp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --transition: 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        body.mode-kid { background: #0c4a6e; color: #f0f9ff; }
        body.mode-adult { background: #1e293b; color: #e2e8f0; }
        body.mode-admin { background: #020617; color: #f8fafc; font-family: 'JetBrains Mono', monospace; }

        body { transition: background var(--transition); height: 100vh; overflow: hidden; display: flex; opacity: 0; animation: fadeInBody 1s forwards 0.5s; }
        @keyframes fadeInBody { to { opacity: 1; } }

        .hidden { display: none !important; }

        /* --- ANIMATIONS --- */
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.8s var(--transition) forwards; }
        
        .boot-screen { background: #000; z-index: 10000; position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        
        /* Typewriter Effect */
        .typewriter { overflow: hidden; border-right: 3px solid #38bdf8; white-space: nowrap; margin: 0 auto; letter-spacing: .15em; animation: typing 2s steps(30, end), blink-caret .75s step-end infinite; }
        @keyframes typing { from { width: 0 } to { width: 100% } }
        @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: #38bdf8; } }

        /* UI ELEMENTS */
        .overlay-glass { background: radial-gradient(circle at center, #0f172a 0%, #020617 100%); z-index: 9999; }
        .magic-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-magical { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 12px; border-radius: 12px; width: 100%; outline: none; font-size: 0.8rem; transition: 0.3s; }
        .input-magical:focus { border-color: #38bdf8; box-shadow: 0 0 15px rgba(56, 189, 248, 0.2); }

        .sidebar { background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.05); width: 280px; }
        .nav-btn { width: 100%; text-align: left; padding: 12px; border-radius: 12px; font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.4); transition: 0.3s; }
        .nav-btn:hover, .nav-btn.active { background: rgba(255,255,255,0.05); color: white; transform: translateX(5px); }

        .thread-item { display: flex; align-items: center; justify-content: space-between; padding: 8px; border-radius: 8px; transition: 0.2s; cursor: pointer; }
        .thread-item:hover { background: rgba(255,255,255,0.1); padding-left: 12px; }
        .del-btn { color: #ef4444; font-size: 8px; font-weight: 900; opacity: 0.3; transition: 0.2s; padding: 4px; }
        .thread-item:hover .del-btn { opacity: 1; }
    </style>
</head>
<body id="mainBody" class="mode-kid">

    <div id="bootScreen" class="boot-screen font-mono">
        <div class="mb-6 text-center">
            <div class="text-sky-400 text-xs mb-2 animate-pulse">MOBBY_OS v2.0 // SIC CORP</div>
            <div class="text-[10px] text-white/40" id="bootLog">Initializing core...</div>
        </div>
        <div class="w-64 h-1 bg-white/10 rounded-full overflow-hidden mb-4">
            <div id="bootProgress" class="h-full bg-sky-500 w-0 transition-all duration-700"></div>
        </div>
        <div class="text-[9px] text-sky-500/50 uppercase tracking-widest" id="groqStatus">Groq LPU Engine: Pending</div>
    </div>

    <div id="loginOverlay" class="fixed inset-0 overlay-glass flex items-center justify-center hidden">
        <div class="magic-card p-10 rounded-[2.5rem] w-full max-w-sm text-center animate-slide-up">
            <h1 class="text-3xl font-black text-white tracking-tighter mb-8 italic">MOBBY<span class="text-sky-400">OS</span></h1>
            <div class="space-y-3">
                <input type="email" id="loginEmail" placeholder="Email Address" class="input-magical">
                <input type="password" id="loginPass" placeholder="Password" class="input-magical">
                <button id="emailAuthBtn" class="w-full bg-white text-black py-3 rounded-xl font-black uppercase text-[10px] hover:bg-sky-400 transition">Initialize</button>
            </div>
            <button id="switchAuthBtn" class="mt-6 text-[9px] text-white/40 font-bold uppercase hover:text-white">Need account? Register</button>
        </div>
    </div>

    <aside class="sidebar flex flex-col p-6">
        <div class="mb-10 flex items-center gap-3">
            <img id="sidePFP" src="https://i.imgur.com/r6oJp4O.png" style="width:32px; height:32px; border-radius:50%; object-fit:cover;">
            <div>
                <h1 class="text-sm font-black text-white tracking-tighter">MOBBYOS</h1>
                <div class="text-[8px] font-bold text-sky-400 uppercase tracking-widest">SIC Corp</div>
            </div>
        </div>
        <nav class="space-y-1">
            <button onclick="showView('dashboard')" class="nav-btn active" id="btn-dashboard">Dashboard</button>
            <button onclick="showView('terminal')" class="nav-btn" id="btn-terminal">Terminal</button>
            <button onclick="toggleSettings()" class="nav-btn">Settings</button>
        </nav>
        
        <div class="mt-10 mb-4 px-2 flex justify-between items-center">
            <span class="text-[9px] font-black text-white/10 uppercase tracking-widest">Memory Threads</span>
            <button onclick="createNewThread()" class="text-sky-400 text-lg font-bold hover:scale-125 transition">+</button>
        </div>
        <div id="threadList" class="flex-grow overflow-y-auto space-y-1 text-white/40 text-[9px]"></div>
    </aside>

    <main class="flex-grow flex flex-col p-8 relative">
        <div id="view-dashboard" class="h-full flex flex-col space-y-8">
            <div class="max-w-2xl">
                <h2 class="text-5xl font-black text-white tracking-tighter mb-2 typewriter" id="welcomeText">
                    Welcome, <span id="userNameDisplay">User</span>
                </h2>
                <p class="text-sky-400 text-[10px] uppercase tracking-[0.5em] font-bold opacity-0 animate-slide-up" style="animation-delay: 1.5s;">System Protocol Active</p>
            </div>
            <div class="bg-white/5 border border-white/5 p-8 rounded-[2rem] max-w-lg animate-slide-up" style="animation-delay: 0.3s;">
                <p class="text-sm text-white/60 leading-relaxed italic">"SIC Corp: Empowering NexaFlow neural networks."</p>
                <div class="mt-4 p-3 bg-black/20 border-l-2 border-sky-500 text-[11px] text-white/40">
                    MobbyOS is now synced with Groq Hardware for ultra-fast response times.
                </div>
            </div>
        </div>

        <div id="view-terminal" class="h-full flex flex-col hidden">
            <div id="chatBox" class="flex-grow overflow-y-auto space-y-4 mb-6 pr-4"></div>
            <div class="max-w-4xl mx-auto w-full flex items-center gap-4 px-6 border border-white/10 rounded-2xl bg-black/40">
                <input type="text" id="userInput" placeholder="Ask Mobby via Groq..." class="flex-grow bg-transparent py-6 outline-none text-sm text-white">
                <button id="sendBtn" class="text-sky-400 font-black text-xs uppercase">Run</button>
            </div>
        </div>

        <div id="settingsTab" class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-6 hidden">
            <div class="w-full max-w-md p-10 bg-slate-900 border border-white/10 rounded-[2.5rem]">
                <h2 class="text-lg font-black text-white mb-6 uppercase tracking-widest">Config</h2>
                <div class="space-y-4">
                    <select id="modeSelect" class="input-magical w-full"><option value="kid">Kid</option><option value="adult">Adult</option><option value="admin">Admin</option></select>
                    <input type="text" id="settingName" class="input-magical w-full" placeholder="New Codename">
                    <button id="saveSettingsBtn" class="w-full bg-sky-500 text-white py-4 rounded-xl font-black uppercase text-[10px]">Commit Changes</button>
                    <button onclick="toggleSettings()" class="w-full text-white/20 py-2 text-[8px] font-black uppercase">Close</button>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, deleteDoc, collection, query, getDocs, orderBy, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyAPgNEVr315jkYcww3MpjAOL93Dfgtl_k8", authDomain: "mobbyoswebapp.firebaseapp.com", projectId: "mobbyoswebapp", storageBucket: "mobbyoswebapp.firebasestorage.app", messagingSenderId: "6814948758", appId: "1:6814948758:web:a87a03eff182e0029091b7" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- GROQ BOOT SEQUENCE ---
        window.addEventListener('DOMContentLoaded', () => {
            const bar = document.getElementById('bootProgress');
            const log = document.getElementById('bootLog');
            const groq = document.getElementById('groqStatus');

            const steps = [
                {p: 20, t: "Mounting SIC Corp Filesystem...", g: "Pending"},
                {p: 50, t: "Syncing NexaFlow Protocols...", g: "Initializing..."},
                {p: 80, t: "Injecting Groq LPU Code...", g: "Injecting Code..."},
                {p: 100, t: "System Ready.", g: "Groq LPU: ONLINE"}
            ];

            steps.forEach((step, i) => {
                setTimeout(() => {
                    bar.style.width = step.p + '%';
                    log.innerText = step.t;
                    groq.innerText = "Groq LPU Engine: " + step.g;
                    if(step.p === 100) {
                        setTimeout(() => {
                            document.getElementById('bootScreen').style.opacity = '0';
                            setTimeout(() => document.getElementById('bootScreen').classList.add('hidden'), 500);
                        }, 800);
                    }
                }, i * 600);
            });
        });

        // --- VIEW LOGIC ---
        window.showView = (name) => {
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-terminal').classList.add('hidden');
            document.getElementById(`view-${name}`).classList.remove('hidden');
        };

        window.toggleSettings = () => document.getElementById('settingsTab').classList.toggle('hidden');

        // --- CHAT WITH GROQ PLACEHOLDER ---
        document.getElementById('sendBtn').onclick = async () => {
            const text = document.getElementById('userInput').value;
            if(!text) return;
            document.getElementById('chatBox').innerHTML += `<div class="text-white text-sm"><b>You:</b> ${text}</div>`;
            document.getElementById('userInput').value = '';
            // Logic for calling Groq API would go here
        };

        // --- AUTH MONITOR ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('loginOverlay').classList.add('hidden');
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if(userDoc.exists()) {
                    document.getElementById('userNameDisplay').innerText = userDoc.data().displayName || "User";
                }
            } else {
                document.getElementById('loginOverlay').classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
